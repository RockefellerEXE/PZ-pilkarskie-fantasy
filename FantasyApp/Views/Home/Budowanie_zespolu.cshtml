@model IEnumerable<FantasyApp.Models.Zawodnik>
@{
    ViewData["Title"] = "Budowanie zespołu";
}
<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link href="~/css/budowanie_zespolu.css" rel="stylesheet" />
    <script src="~/js/budowanie_zespolu.js"></script>
</head>
<body>
    <div class="container">
        <!-- Przyciski nawigacji -->
        <div class="button-group">
            <button class="nav-button active" onclick="showSection('team')">Wybór zespołu</button>
            <button class="nav-button" onclick="showSection('points')">Punkty</button>
            <button class="nav-button" onclick="showSection('transfers')">Transfery</button>
        </div>
        @if (!ViewData.ModelState.IsValid)
        {
            <div class="alert alert-danger">
                @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                {
                    <p style="color: red;">@error.ErrorMessage</p>
                }
            </div>

        }
        @if (ViewBag.SuccessMessage != null)
        {
            <div class="alert alert-success">
                <p style="color: green;">@ViewBag.SuccessMessage</p>
            </div>
        }

        <!-- Sekcja: Wybór zespołu -->
        <div id="team" class="content-section hidden-before-load active">
            <h1>Wybierz swój zespół</h1>
            <h4>###Nazwa zespołu###</h4>
            <p>Aktualny budżet: @ViewBag.Budzet</p>
            <div class="team-grid">
                @{
                    var zawodnicy = (IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie;
                    var groupedPlayers = zawodnicy.GroupBy(z => z.PozycjaWDruzynie);
                }
                <!-- Bramkarz -->
                <div class="goalkeeper">
                    @{
                        int goalkeeperCount = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Count(z => z.PozycjaWDruzynie == "Bramkarz");
                        int maxGoalkeepers = 1; // Liczba miejsc dla bramkarzy
                    }
                    @foreach (var zawodnik in ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Bramkarz"))
                    {
                        <div class="player" data-position="goalkeeper">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <form asp-action="UsunZDruzyny" asp-controller="Home" method="post">
                                <input type="hidden" name="zawodnikId" value="@zawodnik.ZawodnikId" />
                                <input type="hidden" name="pozycja" value="@ViewBag.Pozycja" />
                                <button type="submit" class="btn btn-danger">Usuń</button>
                            </form>
                        </div>
                    }
                    @for (int i = goalkeeperCount; i < maxGoalkeepers; i++)
                    {
                        <div class="player empty" data-position="goalkeeper">
                            <span>Bramkarz</span>
                        </div>
                    }
                </div>

                <!-- Obrońcy -->
                <div class="defenders">
                    @{
                        int defenderCount = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Count(z => z.PozycjaWDruzynie == "Obrońca");
                        int maxDefenders = 4; // Liczba miejsc dla obrońców
                    }
                    @foreach (var zawodnik in ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Obrońca"))
                    {
                        <div class="player" data-position="defender">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <form asp-action="UsunZDruzyny" asp-controller="Home" method="post">
                                <input type="hidden" name="zawodnikId" value="@zawodnik.ZawodnikId" />
                                <input type="hidden" name="pozycja" value="@ViewBag.Pozycja" />
                                <button type="submit" class="btn btn-danger">Usuń</button>
                            </form>
                        </div>
                    }
                    @for (int i = defenderCount; i < maxDefenders; i++)
                    {
                        <div class="player empty" data-position="defender">
                            <span>Obrońca</span>
                        </div>
                    }
                </div>

                <!-- Pomocnicy -->
                <div class="midfielders">
                    @{
                        int midfielderCount = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Count(z => z.PozycjaWDruzynie == "Pomocnik");
                        int maxMidfielders = 3; // Liczba miejsc dla pomocników
                    }
                    @foreach (var zawodnik in ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Pomocnik"))
                    {
                        <div class="player" data-position="midfielder">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <form asp-action="UsunZDruzyny" asp-controller="Home" method="post">
                                <input type="hidden" name="zawodnikId" value="@zawodnik.ZawodnikId" />
                                <input type="hidden" name="pozycja" value="@ViewBag.Pozycja" />
                                <button type="submit" class="btn btn-danger">Usuń</button>
                            </form>
                        </div>
                    }
                    @for (int i = midfielderCount; i < maxMidfielders; i++)
                    {
                        <div class="player empty" data-position="midfielder">
                            <span>Pomocnik</span>
                        </div>
                    }
                </div>

                <!-- Napastnicy -->
                <div class="forwards">
                    @{
                        int forwardCount = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Count(z => z.PozycjaWDruzynie == "Napastnik");
                        int maxForwards = 3; // Liczba miejsc dla napastników
                    }
                    @foreach (var zawodnik in ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Napastnik"))
                    {
                        <div class="player" data-position="forward">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <form asp-action="UsunZDruzyny" asp-controller="Home" method="post">
                                <input type="hidden" name="zawodnikId" value="@zawodnik.ZawodnikId" />
                                <input type="hidden" name="pozycja" value="@ViewBag.Pozycja" />
                                <button type="submit" class="btn btn-danger">Usuń</button>
                            </form>
                        </div>
                    }
                    @for (int i = forwardCount; i < maxForwards; i++)
                    {
                        <div class="player empty" data-position="forward">
                            <span>Napastnik</span>
                        </div>
                    }
                </div>
            </div>

        </div>

        <!-- Sekcja: Punkty -->
        <div id="points" class="content-section hidden-before-load">
            <h1>Punkty</h1>
            <h4>###Nazwa zespołu###</h4>
            <div class="team-grid">
                <!-- Bramkarze -->
                <div class="goalkeeper">
                    @{
                        var goalkeeperList = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Bramkarz");
                    }
                    @foreach (var zawodnik in goalkeeperList)
                    {
                        <div class="player" data-position="goalkeeper">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                             <span>Punkty: @zawodnik.Punkty</span> <!-- Wyświetlenie punktów -->
                        </div>
                    }
                </div>

                <!-- Obrońcy -->
                <div class="defenders">
                    @{
                        var defenderList = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Obrońca");
                    }
                    @foreach (var zawodnik in defenderList)
                    {
                        <div class="player" data-position="defender">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <span>Punkty: @zawodnik.Punkty</span> <!-- Wyświetlenie punktów -->
                        </div>
                    }
                </div>

                <!-- Pomocnicy -->
                <div class="midfielders">
                    @{
                        var midfielderList = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Pomocnik");
                    }
                    @foreach (var zawodnik in midfielderList)
                    {
                        <div class="player" data-position="midfielder">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <span>Punkty: @zawodnik.Punkty</span> <!-- Wyświetlenie punktów -->
                        </div>
                    }
                </div>

                <!-- Napastnicy -->
                <div class="forwards">
                    @{
                        var forwardList = ((IEnumerable<dynamic>)ViewBag.ZawodnicyWDruzynie).Where(z => z.PozycjaWDruzynie == "Napastnik");
                    }
                    @foreach (var zawodnik in forwardList)
                    {
                        <div class="player" data-position="forward">
                            <span>@zawodnik.Nazwisko</span>
                            <span>@zawodnik.KlubNazwa</span>
                            <span>Punkty: @zawodnik.Punkty</span> <!-- Wyświetlenie punktów --> 
                        </div>
                    }
                </div>

                <!-- Ławka -->
                <div class="bench">
                    <h2>Ławka</h2>
                    <ol>
                        @foreach (var zawodnik in ViewBag.ZawodnicyWDruzynie)
                        {
                            if (zawodnik.PozycjaWDruzynie == "Ławka")
                            {
                                <li>
                                    @zawodnik.Nazwisko - @zawodnik.KlubNazwa  - Punkty: @zawodnik.Punkty 
                                </li>
                            }
                        }
                    </ol>
                </div>
            </div>
        </div>


        <!-- Sekcja: Transfery -->
        <div id="transfers" class="content-section hidden-before-load">
            <h1>Transfery</h1>
            <h4>###Nazwa zespołu###</h4>
            <form method="get" action="/Home/Budowanie_zespolu">
                <select name="pozycja" id="transferyDropdown" class="dropdown" onchange="this.form.action += '#transfers'; this.form.submit()">
                    <optgroup label="Pozycje">
                        @if (ViewBag.Pozycja == "Wszyscy")
                        {
                            <option value="Wszyscy" selected>Wszyscy zawodnicy</option>
                        }
                        else
                        {
                            <option value="Wszyscy">Wszyscy zawodnicy</option>
                        }
                        @if (ViewBag.Pozycja == "Bramkarz")
                        {
                            <option value="Bramkarz" selected>Bramkarz</option>
                        }
                        else
                        {
                            <option value="Bramkarz">Bramkarz</option>
                        }
                        @if (ViewBag.Pozycja == "Obrońca")
                        {
                            <option value="Obrońca" selected>Obrońca</option>
                        }
                        else
                        {
                            <option value="Obrońca">Obrońca</option>
                        }
                        @if (ViewBag.Pozycja == "Pomocnik")
                        {
                            <option value="Pomocnik" selected>Pomocnik</option>
                        }
                        else
                        {
                            <option value="Pomocnik">Pomocnik</option>
                        }
                        @if (ViewBag.Pozycja == "Napastnik")
                        {
                            <option value="Napastnik" selected>Napastnik</option>
                        }
                        else
                        {
                            <option value="Napastnik">Napastnik</option>
                        }
                    </optgroup>
                </select>
            </form>

            <table class="zawodnik-table">
                <thead>
                    <tr>
                        <th>Nazwisko</th>
                        <th>Klub</th>
                        <th>Cena</th>
                        @if (ViewBag.Pozycja == "Wszyscy")
                        {
                            <th>Pozycja</th>
                        }
                        <th>Akcja</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var zawodnik in Model)
                    {
                        <tr>
                            <td>@zawodnik.Nazwisko</td>
                            <td>@zawodnik.Klub.Nazwa</td>
                            <td>@zawodnik.Cena</td>
                            @if (ViewBag.Pozycja == "Wszyscy")
                            {
                                <td>@zawodnik.Pozycja</td>
                            }
                            <td>
                                <form asp-action="DodajDoDruzyny" asp-controller="Home" method="post">
                                    <input type="hidden" name="zawodnikId" value="@zawodnik.ZawodnikId" />
                                    <input type="hidden" name="pozycja" value="@ViewBag.Pozycja" />
                                    <button type="submit" class="btn btn-success">Dodaj do drużyny</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
